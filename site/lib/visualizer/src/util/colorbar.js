"use strict";define(["lodash","d3","src/util/util","chroma"],function(a,b,c,d){function e(a){return"left"===a||"right"===a?["0%","0%","0%","100%"]:["0%","0%","100%","0%"]}var f={};return c.loadCss("src/util/colorbar.css"),f.getColorScale=function(c){var e,f=b.min(c.domain),g=b.max(c.domain);e="values"!==c.stopType?c.stopPositions.map(function(a){return f+a*(g-f)}):a.cloneDeep(c.stopPositions);var h=c.stops.map(function(a){var b=d(a);return{color:b.hex(),opacity:b.alpha()}});return e.unshift(Number.MIN_VALUE),e.push(Number.MAX_VALUE),h.push(h[h.length-1]),h.unshift(h[0]),b.scale.linear().domain(e).range(h)},f.getSvg=function(a){var b=$("<div>")[0];return f.renderSvg(b,a)},f.renderSvg=function(a,d){var f;if("values"===d.stopType){var g=b.max(d.stopPositions),h=b.min(d.stopPositions);f=d.stopPositions.map(function(a){return(a-h)/(g-h)})}else f=d.stopPositions;var i=e(d.axis.orientation),j=30,k=d.width+j,l=d.height+j,m=b.select(a).append("svg").attr("width",k).attr("height",l),n=c.getNextUniqueId();m.append("defs").append("linearGradient").attr({x1:i[0],y1:i[1],x2:i[2],y2:i[3],id:n}).selectAll("stop").data(d.stops).enter().append("stop").attr("offset",function(a,b){return""+100*f[b]+"%"}).style("stop-color",function(a){return a}).style("stop-opacity",1);var o=m.append("g").attr("class","key").attr("transform",function(){var a=0,b=0;return"left"===d.axis.orientation||"right"===d.axis.orientation?b+=j/2:"bottom"!==d.axis.orientation&&"top"!==d.axis.orientation||(a+=j/2),"left"===d.axis.orientation&&(a+=j),"top"===d.axis.orientation&&(b+=j),"translate("+a+","+b+")"});o.append("rect").style("fill","url(#"+n+")").attr("width",d.width).attr("height",d.height);var p=b.scale.linear().domain(d.domain).nice().range([0,"bottom"===d.axis.orientation||"top"===d.axis.orientation?d.width:d.height]),q=b.svg.axis().scale(p).orient(d.axis.orientation).tickSize(6);return d.axis.ticks?q.ticks(d.axis.ticks):d.axis.tickValues&&q.tickValues(d.axis.tickValues),o.append("g").attr("class","key").attr("transform",function(){var a=0,b=0;return"bottom"===d.axis.orientation?b+=d.height:"right"===d.axis.orientation&&(a+=d.width),"translate("+a+","+b+")"}).call(q),m.html()},f});