define(["src/util/util","src/util/api","modules/modulefactory","src/main/grid","select2"],function(a,b,c,d){return function(){a.loadCss("components/select2/dist/css/select2.css").then(function(){function a(a){return a.moduleName||a.text}for(var e=c.getModulesById(),f=Object.keys(e),g=new Array(f.length),h=b.getLayerNames(),i=b.getActiveLayerName(),j=[],k=0;k<f.length;k++)g[k]=e[f[k]],g[k].text=f[k]+" "+g[k].moduleName,g[k].cat="module";for(k=0;k<h.length;k++){var l={};l.text=h[k],l.cat="layer",l.id="layer-"+h[k],h[k]===i&&(l.disabled=!0),j.push(l)}var m='<div><div style="height:50px"></div> <select>',n=500,o=Math.max(document.documentElement.clientWidth,window.innerWidth||0),p=Math.max(document.documentElement.clientHeight,window.innerHeight||0);m+="</select></div>",m=$(m),m=m.css({position:"fixed","justify-content":"center",top:0,left:0,width:o,height:p,paddingLeft:Math.floor(o/2-n/2),paddingTop:50,margin:0,"box-sizing":"border-box",opacity:.7,backgroundColor:"#262b33"}).appendTo("body").find("select").addClass("js-example-basic-single").css({width:n,zIndex:5e3});var q=[];j.length&&q.push({id:"layer-list",text:"Layers",children:j}),g.length&&q.push({id:"module-list",text:"Modules",children:g}),m.select2({placeholder:"Select a module",data:q,templateResult:a}).select2("open").val(null).trigger("change");var r;m.on("select2:selecting",function(){r=!0}),m.on("select2:select",function(a){var c=a.params.data.url;m.select2("destroy"),m.parent().remove(),"module"===a.params.data.cat?d.newModule(c):"layer"===a.params.data.cat&&b.switchToLayer(a.params.data.text)}),m.on("select2:close",function(){r||(m.select2("destroy"),m.parent().remove())})})}});