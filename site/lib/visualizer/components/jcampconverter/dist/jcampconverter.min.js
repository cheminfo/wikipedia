// jcampconverter@v2.0.5, MIT licensed. https://github.com/cheminfo/jcampconverter
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JcampConverter=e()}}(function(){return function e(t,r,a){function i(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return i(r?r:e)},p,p.exports,e,t,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(e,t){function r(){function e(e){for(var t=e.length,r=new Array(t),a=0;t>a;a++)r[a]=parseFloat(e[a]);return r}function t(t,l){l=l||{};var p=/^[A-Z]+$/;l.keepRecordsRegExp&&(p=l.keepRecordsRegExp);var u,c,g,d,h,F,m,v,y,X=new Date,x={},A={};A.profiling=[],A.logs=[];var T=[];A.spectra=T,A.info={};var b={};if("string"!=typeof t)return A;for(A.profiling&&A.profiling.push({action:"Before split to LDRS",time:new Date-X}),d=t.split(/[\r\n]+##/),A.profiling&&A.profiling.push({action:"Split to LDRS",time:new Date-X}),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,"")),h=0,F=d.length;F>h;h++){if(u=d[h],m=u.indexOf("="),m>0?(c=u.substring(0,m),g=u.substring(m+1).trim()):(c=u,g=""),c=c.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"==c&&(v=g.indexOf("\n"),-1==v&&(v=g.indexOf("\r")),v>0)){var E=-1,O=-1;if(y=g.substring(0,v).split(/[ ,;\t]+/),y[0].indexOf("++")>0){var C=y[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),S=y[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=x.symbol.indexOf(C),O=x.symbol.indexOf(S)}-1==E&&(E=0),-1==O&&(O=0),x.first&&(x.first.length>E&&(b.firstX=x.first[E]),x.first.length>O&&(b.firstY=x.first[O])),x.last&&(x.last.length>E&&(b.lastX=x.last[E]),x.last.length>O&&(b.lastY=x.last[O])),x.vardim&&x.vardim.length>E&&(b.nbPoints=x.vardim[E]),x.factor&&(x.factor.length>E&&(b.xFactor=x.factor[E]),x.factor.length>O&&(b.yFactor=x.factor[O])),x.units&&(x.units.length>E&&(b.xUnit=x.units[E]),x.units.length>O&&(b.yUnit=x.units[O])),b.datatable=y[0],y[1]&&y[1].indexOf("PEAKS")>-1?c="PEAKTABLE":y[1]&&(y[1].indexOf("XYDATA")||y[0].indexOf("++")>0)&&(c="XYDATA",b.deltaX=(b.lastX-b.firstX)/(b.nbPoints-1))}if("TITLE"==c)b.title=g;else if("DATATYPE"==c)b.dataType=g,g.indexOf("nD")>-1&&(A.twoD=!0);else if("XUNITS"==c)b.xUnit=g;else if("YUNITS"==c)b.yUnit=g;else if("FIRSTX"==c)b.firstX=parseFloat(g);else if("LASTX"==c)b.lastX=parseFloat(g);else if("FIRSTY"==c)b.firstY=parseFloat(g);else if("NPOINTS"==c)b.nbPoints=parseFloat(g);else if("XFACTOR"==c)b.xFactor=parseFloat(g);else if("YFACTOR"==c)b.yFactor=parseFloat(g);else if("DELTAX"==c)b.deltaX=parseFloat(g);else if(".OBSERVEFREQUENCY"==c||"$SFO1"==c)b.observeFrequency||(b.observeFrequency=parseFloat(g));else if(".OBSERVENUCLEUS"==c)b.xType||(A.xType=g.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"==c)A.indirectFrequency||(A.indirectFrequency=parseFloat(g));else if("$OFFSET"==c)A.shiftOffsetNum=0,A.shiftOffsetVal||(A.shiftOffsetVal=parseFloat(g));else if("$REFERENCEPOINT"==c);else if("VARNAME"==c)x.varname=g.split(/[, \t]+/);else if("SYMBOL"==c)x.symbol=g.split(/[, \t]+/);else if("VARTYPE"==c)x.vartype=g.split(/[, \t]+/);else if("VARFORM"==c)x.varform=g.split(/[, \t]+/);else if("VARDIM"==c)x.vardim=e(g.split(/[, \t]+/));else if("UNITS"==c)x.units=g.split(/[, \t]+/);else if("FACTOR"==c)x.factor=e(g.split(/[, \t]+/));else if("FIRST"==c)x.first=e(g.split(/[, \t]+/));else if("LAST"==c)x.last=e(g.split(/[, \t]+/));else if("MIN"==c)x.min=e(g.split(/[, \t]+/));else if("MAX"==c)x.max=e(g.split(/[, \t]+/));else if(".NUCLEUS"==c)A.twoD&&(A.yType=g.split(/[, \t]+/)[0]);else if("PAGE"==c){b.page=g.trim(),b.pageValue=parseFloat(g.replace(/^.*=/,"")),b.pageSymbol=b.page.replace(/=.*/,"");var R=x.symbol.indexOf(b.pageSymbol),w="";x.units&&x.units[R]&&(w=x.units[R]),A.indirectFrequency&&"PPM"!=w&&(b.pageValue/=A.indirectFrequency)}else"RETENTIONTIME"==c?b.pageValue=parseFloat(g):"XYDATA"==c?(n(A,b),g.match(/.*\+\+.*/)?o(b,g,A):s(b,g,A),T.push(b),b={}):"PEAKTABLE"==c?(n(A,b),s(b,g,A),T.push(b),b={}):a(c)?b[r(c)]=g:c.match(p)&&(A.info[c]=g.trim())}return A.profiling&&A.profiling.push({action:"Finished parsing",time:new Date-X}),A.twoD&&(f(A),A.profiling&&A.profiling.push({action:"Finished countour plot calculation",time:new Date-X}),l.keepSpectra||delete A.spectra),T.length>1&&T[0].dataType.toLowerCase().match(/.*mass./)&&(i(A),A.profiling&&A.profiling.push({action:"Finished GCMS calculation",time:new Date-X})),A.profiling&&A.profiling.push({action:"Total time",time:new Date-X}),A}function r(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function a(e){for(var t=0;t<h.length;t++)if(e==h[t])return!0;return!1}function i(e){var t,a=e.spectra,i=[];for(t=0;t<h.length;t++){var n=r(h[t]);a[0][n]&&i.push(n)}var s={};for(s.gc={},s.ms=[],t=0;t<i.length;t++)s.gc[i[t]]=[];for(t=0;t<a.length;t++){for(var o=a[t],l=0;l<i.length;l++)s.gc[i[l]].push(o.pageValue),s.gc[i[l]].push(parseFloat(o[i[l]]));o.data&&(s.ms[t]=o.data[0])}e.gcms=s}function n(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"==t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),e.shiftOffsetVal){var r=t.firstX-e.shiftOffsetVal;t.firstX=t.firstX-r,t.lastX=t.lastX-r}}function s(e,t,r){var a,i,n,s,o,l=[];e.data=[l];var f=t.split(/,? *,?[;\r\n]+ */),p=0;for(a=1,i=f.length;i>a;a++)if(o=f[a].trim().replace(c,"").split(g),o.length%2==0)for(n=0,s=o.length;s>n;n+=2)l[p++]=parseFloat(o[n])*e.xFactor,l[p++]=parseFloat(o[n+1])*e.yFactor;else r.logs.push("Format error: "+o)}function o(e,t,r){e.deltaX||(e.deltaX=(e.lastX-e.firstX)/(e.nbPoints-1));var a=[];e.data=[a];var i,n,s,o=e.firstX,l=e.firstY,f=t.split(/[\r\n]+/);n=[];for(var p=1,g=f.length;g>p;p++)if(n=f[p].trim().replace(c,"").split(u),n.length>0){if(d){e.firstPoint||(e.firstPoint=parseFloat(n[0]));var h=parseFloat(n[0]-e.firstPoint)*e.xFactor+e.firstX;(i||0==i)&&(h+=e.deltaX),r.logs.push("Checking X value: currentX: "+o+" - expectedCurrentX: "+h)}for(var F=1,m=n.length;m>F;F++)if(1!=F||!i&&0!=i){if(n[F].length>0)if(s=n[F].charCodeAt(0),43==s||45==s||46==s||s>47&&58>s)i=null,l=parseFloat(n[F]),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>63&&74>s)i=null,l=parseFloat(String.fromCharCode(s-16)+n[F].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>96&&106>s)i=null,l=-parseFloat(String.fromCharCode(s-48)+n[F].substring(1)),a.push(o,l*e.yFactor),o+=e.deltaX;else if(s>82&&91>s||115==s){var v=parseFloat(String.fromCharCode(s-34)+n[F].substring(1))-1;115==s&&(v=parseFloat("9"+n[F].substring(1))-1);for(var y=0;v>y;y++)i&&(l+=i),a.push(o,l*e.yFactor),o+=e.deltaX}else 37==s?(i=parseFloat("0"+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX):s>73&&83>s?(i=parseFloat(String.fromCharCode(s-25)+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX):s>105&&115>s&&(i=-parseFloat(String.fromCharCode(s-57)+n[F].substring(1)),l+=i,a.push(o,l*e.yFactor),o+=e.deltaX)}else i=null,s=n[F].charCodeAt(0)}}function l(e){for(var t=0,r=e[0].data[0][0],a=r,i=e.length,n=e[0].data[0].length/2,s=new Array(i),o=0;i>o;o++){s[o]=new Array(n);for(var l=0;n>l;l++)s[o][l]=e[o].data[0][2*l+1],s[o][l]<r&&(r=e[o].data[0][2*l+1]),s[o][l]>a&&(a=e[o].data[0][2*l+1]),0!=o&&0!=l&&(t+=Math.abs(s[o][l]-s[o][l-1])+Math.abs(s[o][l]-s[o-1][l]))}return{z:s,minX:e[0].data[0][0],maxX:e[0].data[0][e[0].data[0].length-2],minY:e[0].pageValue,maxY:e[i-1].pageValue,minZ:r,maxZ:a,noise:t/((i-1)*(n-1)*2)}}function f(e){var t=l(e.spectra);e.contourLines=p(t),delete t.z,e.minMax=t}function p(e){for(var t,r,a,i,n,s=e.noise,o=e.z,l=[],f=7,p=new Float32Array(4),u=[],c=o.length,g=o[0].length,d=e.minX,h=e.maxX,F=(h-d)/(g-1),m=e.minY,v=e.maxY,y=(v-m)/(c-1),X=e.minZ,x=e.maxZ,A=0;2*f>A;A++){var T={};l.push(T);var b=A%2;n=0==b?(x-5*s)*Math.exp(A/2-f)+5*s:-(x-5*s)*Math.exp(A/2-f)-5*s;var E=[];if(T.zValue=n,T.lines=E,!(X>=n||n>=x))for(var O=0;c-1>O;O++)for(var C=0;g-1>C;C++){p[0]=o[O][C],p[1]=o[O][C+1],p[2]=o[O+1][C],p[3]=o[O+1][C+1];for(var S=0;4>S;S++)u[S]=p[S]>n;u[0]!=u[1]&&u[0]!=u[2]&&(t=C+(n-p[0])/(p[1]-p[0]),r=O,a=C,i=O+(n-p[0])/(p[2]-p[0]),E.push(t*F+d,r*y+m,a*F+d,i*y+m)),u[3]!=u[1]&&u[3]!=u[2]&&(t=C+1,r=O+1-(n-p[3])/(p[1]-p[3]),a=C+1-(n-p[3])/(p[2]-p[3]),i=O+1,E.push(t*F+d,r*y+m,a*F+d,i*y+m)),u[1]!=u[2]&&(t=C+1-(n-p[1])/(p[2]-p[1]),r=O+(n-p[1])/(p[2]-p[1]),u[1]!=u[0]&&(a=C+1-(n-p[1])/(p[0]-p[1]),i=O,E.push(t*F+d,r*y+m,a*F+d,i*y+m)),u[2]!=u[0]&&(a=C,i=O+1-(n-p[2])/(p[0]-p[2]),E.push(t*F+d,r*y+m,a*F+d,i*y+m)),u[1]!=u[3]&&(a=C+1,i=O+(n-p[1])/(p[3]-p[1]),E.push(t*F+d,r*y+m,a*F+d,i*y+m)),u[2]!=u[3]&&(a=C+(n-p[2])/(p[3]-p[2]),i=O+1,E.push(t*F+d,r*y+m,a*F+d,i*y+m)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:l}}var u=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,g=/[,\t ]+/,d=!1,h=["TIC",".RIC","SCANNUMBER"];return t}function a(e,t,r){return"boolean"==typeof t&&(r=t,t={}),r?i(e,t):o(e,t)}function i(e,t){return s||n(),new Promise(function(r){var a=Date.now()+""+Math.random();l[a]=r,s.postMessage({stamp:a,input:e,options:t})})}function n(){var e=URL.createObjectURL(new Blob(["var getConverter ="+r.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));s=new Worker(e),URL.revokeObjectURL(e),s.addEventListener("message",function(e){var t=e.data.stamp;l[t]&&l[t](e.data.output)})}var s,o=r(),l={};t.exports={convert:a}},{}]},{},[1])(1)});
//# sourceMappingURL=jcampconverter.min.js.map