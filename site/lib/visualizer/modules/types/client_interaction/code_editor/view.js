'use strict';define(["jquery","lodash","modules/default/defaultview","src/util/util","ace/ace","src/util/context","src/util/aceHelper"],function(a,b,c,d,e,f,g){"use strict";function h(){this._id=d.getNextUniqueId(),this._code="",this._data=null}return a.extend(!0,h.prototype,c,{init(){var c=this.table=a("<table>").css({height:"100%",width:"100%"}),d=a("<tr>").appendTo(c).css("height","auto");this.buttonRow=a("<tr>").appendTo(c).css("height","30px"),this.editorCell=a("<td>").css("height","100%").appendTo(d),this.buttonCell=a("<td>").appendTo(this.buttonRow).css("text-align","center");var e=this.module.getConfiguration("debouncing");this.editorChangedDebounced=0<e?b.debounce(this.editorChanged.bind(this,!1),e):-1===e?this.editorChanged.bind(this,!0):this.editorChanged.bind(this,!1),this.module.getDomContent().html(c)},inDom(){var b=(this.module.getConfiguration("script")||"")+"";if(this.setCode(b,!1,!0),this.module.getConfigurationCheckbox("iseditable","editable")){this.editable=!0,a(`<div id="${this._id}"></div>`).css("height","100%").css("width","100%").appendTo(this.editorCell),this.editor=e.edit(this._id);var c=`./mode/${this.module.getConfiguration("mode")}`;g.applyConfig(this.module,this.editor),this.editor.$blockScrolling=1/0,this.editor.getSession().setOption("useWorker",!1),this.editor.getSession().setMode(c),this.editor.setValue(b,-1),this.editor.getSession().on("change",this.editorChangedDebounced)}this.module.getConfigurationCheckbox("hasButton","button")?this.buttonCell.append(a(`<button>${this.module.getConfiguration("btnvalue")}</button>`).addClass("form-button").on("click",()=>this.module.controller.onButtonClick(this.getCode()))):this.buttonRow.remove(),this.resolveReady()},blank:{data(){this._data=null,this.setCode("",!1,!0),this.editable&&this.editor.setValue("")}},update:{data(a){this._data=a;var b=a.get()+"";if(this.setCode(b,!1,!0),this.editable){var c=this.editor.getValue();if(b===c)return;this.editor.setValue(b),this.editor.scrollToLine(0),this.editor.clearSelection()}}},editorChanged(a){this.setCode(this.editor.getValue(),a,!1)},onResize(){this.editor&&this.editor.resize()},setCode(a,b,c){var d=this._code;d===a||(this._code=a,this.module.getConfigurationCheckbox("storeOnChange","store")&&this.module.definition.configuration.groups&&(this.module.definition.configuration.groups.group[0].script[0]=a),!b&&this.module.controller.onEditorChanged(a,c))},getCode(){return this._code}}),h});
