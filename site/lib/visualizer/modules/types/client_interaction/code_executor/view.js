'use strict';define(["modules/default/defaultview","src/util/util","ace/ace","src/util/context","jquery","forms/button"],function(a,b,c,d,e,f){"use strict";function g(){}return e.extend(!0,g.prototype,a),g.prototype.init=function(){this._id=b.getNextUniqueId(),this._code="";var a=this.table=e("<table>").css({height:"100%",width:"100%",bottom:0}),c=e("<tr>").appendTo(a).css("height","auto");this.editorRow=c,this.buttonRow=e("<tr>").appendTo(a).css("height","30px"),this.editorCell=e("<td>").css("height","100%").appendTo(c),this.buttonCell=e("<td>").appendTo(this.buttonRow).css("text-align","center"),this._input={},this.buttons=[],this.module.getDomContent().html(a)},g.prototype.inDom=function(){var a=this,b=this.module.getConfiguration("script")||"";if(this._code=b,this.module.getConfigurationCheckbox("display","editor")?(e(`<div id="${this._id}"></div>`).css("height","100%").css("width","100%").appendTo(this.editorCell),this.editor=c.edit(this._id),this.editor.$blockScrolling=1/0,this.editor.getSession().setOption("useWorker",!1),this.editor.getSession().setMode("./mode/javascript"),this.editor.setValue(b,-1),this.editor.getSession().on("change",this.editorChanged.bind(this)),this.table.css({height:"100%"})):this.table.css({height:"auto"}),this.module.getConfigurationCheckbox("display","buttons")){var d=this.module.getConfiguration("buttons");d?d.forEach(function(c,d){var e=a.module.controller.onButtonClick.bind(a.module.controller,c.name),g=new f(c.label,e,{color:"Grey",disabled:!1});g.name=c.name,c.hide&&-1<c.hide.indexOf("hide")&&g.hide(),c.disable&&-1<c.disable.indexOf("disable")&&g.disable(),a.buttonCell.append(g.render()),a.buttons.push(g),0===d&&a.editor&&a.editor.commands.addCommand({name:"run",bindKey:{win:"Ctrl-Return",mac:"Command-Return"},exec:e})}):this.buttonRow.css("height",0)}else this.buttonRow.css("height",0);this.resolveReady()},g.prototype.disableButtons=function(){this.buttons.forEach(a=>a.disable())},g.prototype.enableButtons=function(){this.buttons.forEach(a=>{a.disabledFromScript||a.enable()})},g.prototype.onResize=function(){this.editor&&(30>this.height-this.buttonRow.height()?this.editorCell.hide():(this.editorCell.show(),this.editor.resize()))},g.prototype.editorChanged=function(){var a=this.editor.getValue();this._code=a,this.module.definition.configuration.groups.group[0].script[0]=a},g.prototype.blank.inputValue=function(a){this._input[a]=null},g.prototype.update.inputValue=function(a,b){this._input[b]=a,this.module.controller.onVariableIn(b)},g.prototype.onActionReceive.execute=function(a,b){this.module.controller.onActionIn(b,a)},g});
