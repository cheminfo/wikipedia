'use strict';define(["modules/default/defaultview","src/util/util","jquery","components/onde/src/onde","forms/button","lodash","src/util/debug","src/util/api","src/util/sandbox"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){this._id=b.getNextUniqueId()}return b.loadCss("components/onde/src/onde.css"),c.extend(!0,j.prototype,a,{init(){const a=this.module.getConfiguration("onchangeFilter");if(a){const b=new i;b.setContext({API:h}),this.filter=b.run(`(function ondeOnChangeFilter(data, jpath) { try { \n ${a}\n } catch(_) { console.log(_); } })`,"ondeOnChangeFilter")}this.dom=c(`<form id="${this._id}">`).css({height:"100%",width:"100%",textAlign:"left"}).append(c("<div class=\"onde-panel\">")),this.module.getConfigurationCheckbox("hasButton","show")&&this.dom.append(new e(this.module.getConfiguration("button_text"),()=>{this.exportForm()},{color:"green"}).render().css({marginTop:"10px"})),this.dom.on("submit",a=>(a.preventDefault(),this.exportForm(),!1));const b=this.module.getConfiguration("debouncing",-1);if(-1<b){let a=()=>{this.exportForm()};0<b&&(a=f.debounce(a,b)),registerCallback(this.dom,a)}this.filter&&registerCallback(this.dom,a=>{this._doFilter(a)}),this.inputVal=null},_doFilter(a){var b=!0,d=c(a.target),e=d.data("fieldInfo");e||(e=d.parents("ol").first().data("fieldInfo")),e||(b=!1);for(var f,h,i=e.jpath.slice().reverse();-1<i.indexOf("$array$")&&(f=d.parents("ol").first(),!!f.length)&&!!c.contains(this.dom[0],f[0]);)h=f.children("li").index(d.parents("li.field.array-item")[0]),d=f,i[i.indexOf("$array$")]=h;i=i.reverse(),(-1<i.indexOf("$array$")||-1<i.indexOf(-1))&&(b=!1),b?this.filter(this.form.getData(),i):g.warn("Onde: Could not resolve jpath of modified element")},blank:{inputValue(){this.inputObj=null,this.inputVal=null},schema(){this.module.controller.inputSchema={}}},inDom(){this.module.getDomContent().html(this.dom),this.initForm();let a;this.module.getConfigurationCheckbox("saveInView","yes")&&(a=this.module.getConfiguration("varname")),a?h.createData(a,JSON.parse(this.module.getConfiguration("data"))).then(a=>{a.onChange(()=>{this.module.definition.configuration.groups.data[0].data[0]=JSON.stringify(a)}),this.resolveReady()}):this.resolveReady()},initForm(){this.form=new d.Onde(this.dom),this.renderForm(),this.form.on("field:delete",()=>{this.exportForm()})},update:{inputValue:function(a){this.inputObj=a,this.inputVal=a.get().resurrect(),this.renderForm()},schema:function(a){this.module.controller.inputSchema=a.resurrect(),this.renderForm()}},renderForm(){const a=this.module.controller.getSchema();if(!a)return void this.dom.find(".form-button").hide();this.dom.find(".form-button").show();const b=this.inputObj?this.inputObj.get().resurrect():null;this.form.render(a,b,{}),this.module.getConfigurationCheckbox("hasButton","onload")&&this.exportForm()},exportForm(){const a=this.form.getData();a.errorCount||(this._data=a.data,this.module.controller.onSubmit(a.data))}}),j});function registerCallback(a,b){a.on("input",b),a.on("change","[type=\"checkbox\"]",b),a.on("change","[type=\"radio\"]",b)}
