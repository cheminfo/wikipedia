"use strict";define(["modules/default/defaultview","src/util/util","jquery","components/onde/src/onde","forms/button","lodash","src/util/debug"],function(Default,Util,$,onde,Button,_,Debug){function View(){this._id=Util.getNextUniqueId()}return Util.loadCss("components/onde/src/onde.css"),$.extend(!0,View.prototype,Default,{init:function init(){var that=this,filter=this.module.getConfiguration("onchangeFilter");filter&&eval("that.filter = function(data, jpath) { try { \n "+filter+"\n } catch(_) { console.log(_); } }"),this.dom=$('<form id="'+this._id+'">').css({height:"100%",width:"100%",textAlign:"left"}).append($('<div class="onde-panel">')),this.module.getConfigurationCheckbox("hasButton","show")&&this.dom.append(new Button(this.module.getConfiguration("button_text"),function(){that.exportForm()},{color:"green"}).render().css({marginTop:"10px"})),this.dom.on("submit",function(a){return a.preventDefault(),that.exportForm(),!1});var debouncing=this.module.getConfiguration("debouncing",-1);if(debouncing>-1){var cb=function(a){("change"!==a.type||"text"!==a.target.type&&"textarea"!==a.target.type)&&that.exportForm()};debouncing>0&&(cb=_.debounce(cb,debouncing)),this.dom.on("keyup change",cb)}that.filter&&this.dom.on("keyup change",function(a){("change"!==a.type||"text"!==a.target.type&&"textarea"!==a.target.type)&&that._doFilter(a)}),this.inputVal={}},_doFilter:function(a){var b=!0,c=$(a.target),d=c.data("fieldInfo");d||(d=c.parents("ol").first().data("fieldInfo")),d||(b=!1);for(var e=d.jpath.slice().reverse();e.indexOf("$array$")>-1;){var f=c.parents("ol").first();if(!f.length)break;if(!$.contains(this.dom[0],f[0]))break;var g=f.children("li").index(c.parents("li.field.array-item")[0]);c=f,e[e.indexOf("$array$")]=g}e=e.reverse(),(e.indexOf("$array$")>-1||e.indexOf(-1)>-1)&&(b=!1),b?this.filter(this.form.getData(),e):Debug.warn("Onde: Could not resolve jpath of modified element")},blank:{inputValue:function(){this.inputObj=null,this.inputVal=null},schema:function(){this.module.controller.inputSchema={}}},inDom:function(){this.module.getDomContent().html(this.dom),this.initForm(),this.resolveReady()},initForm:function(){var a=this;this.form=new onde.Onde(this.dom),this.renderForm(),this.form.on("field:delete",function(b){a.exportForm()})},update:{inputValue:function(a){this.inputObj=a,this.inputVal=a.get().resurrect(),this.renderForm()},schema:function(a){this.module.controller.inputSchema=a,this.renderForm()}},renderForm:function(){var a=this.module.controller.getSchema();this.form.render(a,this.inputVal,{}),this.module.getConfigurationCheckbox("hasButton","onload")&&this.exportForm()},exportForm:function(){var a=this.form.getData();this.inputVal=a.data,a.errorCount||(this._data=a.data,this.module.controller.onSubmit(a.data))}}),View});