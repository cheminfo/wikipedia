'use strict';function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _wrapRegExp(a,b){function c(a,b){var c=e.call(this,a);return h.set(c,b),c}function d(a,c){var d=h.get(c);return Object.keys(b).reduce(function(b,c){return b[c]=a[d[c]],b},Object.create(null))}_wrapRegExp=function(a,b){return new c(a,b)};var e=_wrapNativeSuper(RegExp),f=RegExp.prototype,h=new WeakMap;return _inherits(c,e),c.prototype.exec=function(a){var b=f.exec.call(this,a);return b&&(b.groups=d(b,this)),b},c.prototype[Symbol.replace]=function(a,b){if("string"==typeof b){var c=h.get(this);return f[Symbol.replace].call(this,a,b.replace(/\$<([^>]+)>/g,function(a,b){return"$"+c[b]}))}if("function"==typeof b){var e=this;return f[Symbol.replace].call(this,a,function(){var a=[];return a.push.apply(a,arguments),"object"!=typeof a[a.length-1]&&a.push(d(a,e)),b.apply(this,a)})}return f[Symbol.replace].call(this,a,b)},_wrapRegExp.apply(this,arguments)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _possibleConstructorReturn(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _wrapNativeSuper(a){var b="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(a){function c(){return _construct(a,arguments,_getPrototypeOf(this).constructor)}if(null===a||!_isNativeFunction(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(c,a)},_wrapNativeSuper(a)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(){return _construct=isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeFunction(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}define(["lodash","src/util/util","src/util/ui","src/data/structures","components/spectrum/spectrum","jquery","jquery-ui/ui/widgets/datepicker"],function(a,b,c,d){"use strict";function e(){if(this.args.column.validator){var a=this.args.column.validator(this.serializeValue());if(!a.valid)return a}return{valid:!0,msg:null}}function f(){return(""!=this.$input.val()||null!=this.defaultValue)&&this.$input.val()!=this.defaultValue}function g(a,b,c){var d;DataObject.check(a,!0),d=c?{type:c,value:b}:b,this.args.grid.module.model?this.args.grid.module.model.dataSetChildSync(a,this.args.column.jpath,d):a.setChildSync(this.args.column.jpath,d)}function h(){return this.$input.val()}function i(){let a=this.$input.val();return a||(a="element"),a.startsWith("element.")||"element"===a||(a=`element.${a}`),b.jpathToArray(a)}function j(a){DataObject.check(a,!0),this.defaultValue=a.getChildSync(this.args.column.jpath),this.defaultValue=this.defaultValue?this.defaultValue.get()||"":"",this.$input.val(this.defaultValue),this.$input[0].defaultValue=this.defaultValue,this.$input.select()}function k(a){DataObject.check(a,!0),this.defaultValue=a.getChildSync(this.args.column.jpath),this.defaultValue=this.defaultValue?this.defaultValue.get()||"":"";const b=this.defaultValue||[],c=b.join(".");this.$input.val(c),this.$input[0].defaultValue=this.defaultValue,this.$input.select()}function l(a){this.$input.val(a)}function m(){return this.$input.val()}function n(){var a=this;this.initOptions=this.initOptions||{};var b=K(this.args.column.colDef.editorOptions);this.initOptions.textarea?($("<div>").appendTo(this.args.container),this.$input=$("<textarea  class=\"editor-text\" rows=\"10\" cols=\"60\" style=\"z-index:10000; position: relative;\"/>")):(this.$input=$("<input type=\"text\" class=\"editor-text\" />"),b.choices&&this.$input.attr("list","choices")),this.$input.appendTo(this.args.container).after(`<datalist id="choices">${J(b.choices)}</datalist>`).bind("keydown.nav",function(a){(a.keyCode===$.ui.keyCode.LEFT||a.keyCode===$.ui.keyCode.RIGHT)&&a.stopImmediatePropagation()}).focus().select().focusout(function(){a.args.grid.module&&!a.args.grid.module.view.slick.options.autoEdit?a.args.commitChanges&&a.args.commitChanges("next"):a.args.commitChanges&&a.args.commitChanges("none")})}function o(){this.$input.remove()}function p(){this.$input.focus().select()}function q(){return+this.$input.val()}function r(b,c,d){return c=+c,g.call(this,b,a.isNaN(c)?"NaN":c,d)}function s(){var a=this;this.$input=$("<input type=\"checkbox\" value=\"true\" class=\"editor-checkbox\" hideFocus>"),this.$input.appendTo(this.args.container),this.$input.focus(),this.$input.change(function(){a.args.commitChanges("next")})}function t(a){if(DataObject.check(a,!0),this.defaultValue=a.getChildSync(this.args.column.jpath),this.defaultValue)var b=this.defaultValue=this.defaultValue.get();b?b instanceof DataBoolean&&!b.get()?this.$input.removeAttr("checked"):this.$input.attr("checked","checked"):this.$input.removeAttr("checked")}function u(){return!!this.$input[0].checked}function v(){return this.serializeValue()!==this.defaultValue}function w(a,b,c){b="false"!==b&&!!b,g.call(this,a,b,c)}function x(){var a=this;this.$container=$("body"),this.$wrapper=$("<DIV style=\"z-index:10000; position:absolute;background:white; padding:5px;border:3px solid gray; -moz-border-radius:10px; border-radius:10px;\"/>").appendTo(this.$container),this.$input=$("<textarea hidefocus rows=5 style=\"backround:white; width:250px; height:80px;border:0; outline:0\">").appendTo(this.$wrapper),$("<div style=\"text-align:right\"><button>Save</button><button>Cancel</button></div>").appendTo(this.$wrapper),this.$wrapper.find("button:first").bind("click",this.save),this.$wrapper.find("button:last").bind("click",this.cancel),this.$input.bind("keydown",function(b){b.which==$.ui.keyCode.ENTER&&b.ctrlKey?a.save():b.which==$.ui.keyCode.ESCAPE?(b.preventDefault(),a.cancel()):b.which==$.ui.keyCode.TAB&&b.shiftKey?(b.preventDefault(),a.args.grid.navigatePrev()):b.which==$.ui.keyCode.TAB&&(b.preventDefault(),a.args.grid.navigateNext())}),this.position(this.args.position),this.$input.focus().select().focusout(function(){a.args.grid.module.view.slick.options.autoEdit||a.args.commitChanges("next")})}function y(){this.args.commitChanges()}function z(){this.$input.val(this.defaultValue),this.args.cancelChanges()}function A(){this.$wrapper.hide()}function B(){this.$wrapper.show()}function C(a){this.$wrapper.css("top",a.top-5).css("left",a.left-5)}function D(){this.$wrapper.remove()}function E(){this.$wrapper.show(),this.position(this.args.position),this.$input.focus()}function F(a){this.args=a,this.init=x,this.destroy=D,this.focus=E,this.getValue=m,this.setValue=l,this.loadValue=j,this.serializeValue=h,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.isValueChanged=f,this.validate=e,this.hide=A,this.show=B,this.position=C,this.save=y.bind(this),this.cancel=z.bind(this),this.init()}function G(a){this.args=a,this.initOptions={textarea:!0},this.init=n,this.destroy=o,this.focus=p,this.getValue=m,this.setValue=l,this.loadValue=j,this.serializeValue=h,this.isValueChanged=f,this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}function H(){var a=this.args.column.editorOptions,b=K(a),c=$(this.args.container);this.initOptions=this.initOptions||{},this.$input=$(`<select>${J(b.choices)}</select>`),this.$input.appendTo(c).focus().on("change",()=>{this.args.commitChanges("next")}).on("blur",()=>{this.args.cancelChanges()}).focusout(()=>{this.args.grid.module.view.slick.options.autoEdit?this.args.commitChanges("none"):this.args.commitChanges("next")})}function I(a,b){this.args=a,this.initOptions=b,this.init=H,this.destroy=o,this.focus=p,this.getValue=m,this.setValue=l,this.loadValue=j,this.serializeValue=h,this.isValueChanged=f,this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}function J(a){let b={};return a?("string"==typeof a?a.split(";").forEach(a=>{const c=a.split(":"),d=_slicedToArray(c,2),e=d[0],f=d[1];b[e]=f||e}):b=a,[...Object.entries(b)].map(a=>{let b=_slicedToArray(a,2),c=b[0],d=b[1];return`<option value="${c}">${d}</option>`}).join("")):[]}function K(a){const c=b.evalOptions(a);return a&&void 0===c?{choices:a}:c||{}}b.loadCss("./components/spectrum/spectrum.css"),function(a){function x(b){this.args=b;var c,d,e=!1;this.init=function(){c=a("<INPUT type=\"text\" class=\"editor-text\" />"),c.appendTo(b.container),c.focus().select(),c.datepicker({showOn:"button",buttonImageOnly:!0,buttonImage:require.toUrl("components/slickgrid/images/calendar.gif"),beforeShow:function(){e=!0},onClose:function(){e=!1}}),c.width(c.width()-18)},this.destroy=function(){a.datepicker.dpDiv.stop(!0,!0),c.datepicker("hide"),c.datepicker("destroy"),c.remove()},this.show=function(){e&&a.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){e&&a.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(b){e&&a.datepicker.dpDiv.css("top",b.top+30).css("left",b.left)},this.focus=function(){c.focus()},this.loadValue=function(a){DataObject.check(a,!0),d=a.getChildSync(b.column.jpath),d=d?d.value||"01/01/2000":"01/01/2000",c.val(d),c[0].defaultValue=d,c.select()},this.serializeValue=function(){return c.val()},this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.isValueChanged=function(){return(""!=c.val()||null!=d)&&c.val()!=d},this.validate=function(){return{valid:!0,msg:null}},this.init()}function y(b){this.args=b;var c;this.init=function(){var c=this;this.$input=a("<input type=\"text\">");var d=b.container.getBoundingClientRect();this.$div=a("<div>").css({position:"fixed",left:d.left,top:d.top}),a("body").append(this.$div),this.$input.appendTo(this.$div).bind("keydown.nav",function(b){(b.keyCode===a.ui.keyCode.LEFT||b.keyCode===a.ui.keyCode.RIGHT)&&b.stopImmediatePropagation()}).focus().select(),this.$input.spectrum({color:b.item&&b.item.getChildSync&&b.item.getChildSync(b.column.jpath)?b.item.getChildSync(b.column.jpath).get():void 0,appendTo:"body",showInitial:!0,showInput:!0,clickoutFiresChange:!1,showAlpha:!0,showPalette:!0,showSelectionPalette:!0,palette:[["rgba(152,  0,  0, 1)","rgba(255,  0,  0, 1)","rgba(255,  153,  0, 1)","rgba(255,  255,  0, 1)","rgba(0,  255,  0, 1)","rgba(0,  255,  255, 1)","rgba(74,  134,  232, 1)","rgba(0,  0,  255, 1)","rgba(153,  0,  255, 1)","rgba(255,  0,  255, 1)"],["rgba(230,  184,  175, 1)","rgba(244,  204,  204, 1)","rgba(252,  229,  205, 1)","rgba(255,  242,  204, 1)","rgba(217,  234,  211, 1)","rgba(208,  224,  227, 1)","rgba(201,  218,  248, 1)","rgba(207,  226,  243, 1)","rgba(217,  210,  233, 1)","rgba(234,  209,  220, 1)"],["rgba(221,  126,  107, 1)","rgba(234,  153,  153, 1)","rgba(249,  203,  156, 1)","rgba(255,  229,  153, 1)","rgba(182,  215,  168, 1)","rgba(162,  196,  201, 1)","rgba(164,  194,  244, 1)","rgba(159,  197,  232, 1)","rgba(180,  167,  214, 1)","rgba(213,  166,  189, 1)"],["rgba(204,  65,  37, 1)","rgba(224,  102,  102, 1)","rgba(246,  178,  107, 1)","rgba(255,  217,  102, 1)","rgba(147,  196,  125, 1)","rgba(118,  165,  175, 1)","rgba(109,  158,  235, 1)","rgba(111,  168,  220, 1)","rgba(142,  124,  195, 1)","rgba(194,  123,  160, 1)"],["rgba(166,  28,  0, 1)","rgba(204,  0,  0, 1)","rgba(230,  145,  56, 1)","rgba(241,  194,  50, 1)","rgba(106,  168,  79, 1)","rgba(69,  129,  142, 1)","rgba(60,  120,  216, 1)","rgba(61,  133,  198, 1)","rgba(103,  78,  167, 1)","rgba(166,  77,  121, 1)"],["rgba(133,  32,  12, 1)","rgba(153,  0,  0, 1)","rgba(180,  95,  6, 1)","rgba(191,  144,  0, 1)","rgba(56,  118,  29, 1)","rgba(19,  79,  92, 1)","rgba(17,  85,  204, 1)","rgba(11,  83,  148, 1)","rgba(53,  28,  117, 1)","rgba(116,  27,  71, 1)"],["rgba(91,  15,  0, 1)","rgba(102,  0,  0, 1)","rgba(120,  63,  4, 1)","rgba(127,  96,  0, 1)","rgba(39,  78,  19, 1)","rgba(12,  52,  61, 1)","rgba(28,  69,  135, 1)","rgba(7,  55,  99, 1)","rgba(32,  18,  77, 1)","rgba(76,  17,  48, 1)"]],preferredFormat:"rgba",change:function(a){c.color=a,c.changed=!0,b.commitChanges("next")},move:function(){},show:function(){},hide:function(){c.changed||b.cancelChanges()},localStorageKey:"visualizer-spectrum"}),this.$input.next().first().click()},this.destroy=function(){this.$input.data();this.$input.spectrum("destroy"),this.$div.remove()},this.focus=function(){this.$input.focus()},this.getValue=function(){this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.loadValue=function(a){DataObject.check(a,!0),c=a.getChildSync(b.column.jpath),c=c?c.get()+""||"#000000":"#000000",this.$input.val(c),this.$input.spectrum("set",c),this.$input[0].defaultValue=c,this.$input.select()},this.serializeValue=function(){return this.color?this.color.toRgbString():this.$input.val()},this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.isValueChanged=function(){return(""!=this.$input.val()||null!=c)&&this.$input.val()!=c},this.validate=function(){if(b.column.validator){var a=b.column.validator(this.$input.val());if(!a.valid)return a}return{valid:!0,msg:null}},this.init()}function z(a,b){this.args=a,this.initOptions=b,this.init=n,this.destroy=o,this.focus=p,this.getValue=m,this.setValue=l,this.loadValue=j,this.serializeValue=h,this.isValueChanged=f,this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}function A(d){function h(){function e(a){a?f.args.commitChanges&&f.args.commitChanges("next"):f.args.commitChanges&&f.args.commitChanges("none")}const f=this,g=a("<div style=\"position: relative;\" />");this.initOptions=this.initOptions||{};var h=K(this.args.column.colDef.editorOptions);if(this.$input=a("<input type=\"text\" class=\"editor-text\" style=\"width: 100%\" class=\"\"/>"),h.choices&&this.$input.attr("list","choices"),this.$input.appendTo(g),d){const h=a("<a style=\"position: absolute; top: 0; right: 0;\" class=\"icon-clickable select-jpath\"\"><i class=\"centered-icon fa fa-tree\"></i></a>");h.appendTo(g),h.on("mousedown",async function(){j=!0;const a=await c.selectJpath(d);j=!1,null===a?e():(f.$input.val(b.jpathToString(a)),e(!0))})}g.appendTo(this.args.container).bind("keydown.nav",function(b){(b.keyCode===a.ui.keyCode.LEFT||b.keyCode===a.ui.keyCode.RIGHT)&&b.stopImmediatePropagation()}).focus().select(),this.$input.focusout(function(){j||e(f.args.grid.module&&!f.args.grid.module.view.slick.options.autoEdit)})}let j=!1;return function(a){this.args=a,this.init=h,this.destroy=o,this.focus=p,this.getValue=q,this.setValue=l,this.loadValue=k,this.serializeValue=i,this.isValueChanged=f,this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}}function B(a){this.args=a,this.init=n,this.destroy=o,this.focus=p,this.getValue=q,this.setValue=l,this.loadValue=j,this.serializeValue=h,this.isValueChanged=f,this.validate=e,this.applyValue=function(a,b){r.call(this,a,b,this.args.column.dataType)},this.init()}function C(a){this.args=a,this.init=s,this.destroy=o,this.focus=p,this.getValue=q,this.setValue=l,this.loadValue=t,this.serializeValue=u,this.isValueChanged=v,this.validate=e,this.applyValue=function(a,b){w.call(this,a,b,this.args.column.dataType)},this.init()}function D(a,b){this.args=a,this.initOptions=b,this.init=n,this.destroy=o,this.focus=p,this.getValue=m,this.setValue=l,this.loadValue=function(a){DataObject.check(a,!0);const b=a.getChildSync(this.args.column.jpath);if(this.item=b,this.defaultValue="",b){const a=b.unit+"";let c=D.mathjs.unit(a);c.value=+b.SI,this.defaultValue=a?`${c.toNumber(a)}`:b.SI}this.$input.val(this.defaultValue),this.$input[0].defaultValue=this.defaultValue,this.$input.select()},this.serializeValue=function(){let a=this.$input.val();if(a)try{const b=K(this.args.column.colDef.editorOptions),c=+a;Number.isNaN(c)||(this.item&&this.item.unit?a=`${a} ${this.item.unit}`:void 0!==b.base&&(a=`${a} ${b.base}`));const d=D.mathjs.unit(D.mathjs.eval(a));if(b.base){const a=D.mathjs.unit(b.base);if(!a.equalBase(d))throw new Error(`${d.formatUnits()} is not the same base as ${b.base}`)}return{unit:d.formatUnits(),SI:d.value}}catch(a){return c.showNotification(a.message,"warning"),null}},this.isValueChanged=()=>null!==this.serializeValue(),this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}function E(a,b){this.args=a,this.initOptions=b,this.init=n,this.destroy=o,this.focus=p,this.getValue=m,this.setValue=l,this.loadValue=a=>{DataObject.check(a,!0);const b=a.getChildSync(this.args.column.jpath);this.item=b,this.defaultValue="",b&&(this.defaultValue=b.value+""+(b.units&&` ${b.units}`)),this.$input.val(this.defaultValue),this.$input[0].defaultValue=this.defaultValue,this.$input.select()},this.serializeValue=()=>{let a=this.$input.val();if(a)try{const b=K(this.args.column.colDef.editorOptions),c=+a;Number.isNaN(c)||(this.item&&this.item.units?a=`${a} ${this.item.units}`:void 0!==b.base&&(a=`${a} ${b.base}`));const d=a.match(_wrapRegExp(/([0-9.-]+[eE]?[0-9.-]*)(.*)/,{stringValue:1,units:2}),"$1").groups,e=d.stringValue,f=d.units;return{value:+e,units:f.trim()}}catch(a){return c.showNotification(a.message,"warning"),null}},this.isValueChanged=()=>null!==this.serializeValue(),this.validate=e,this.applyValue=function(a,b){g.call(this,a,b,this.args.column.dataType)},this.init()}var H={};for(var J in d)"string"==typeof d[J]&&(H[J]=H[d[J]]);H.string=z,H.number=B,H.boolean=C,H.color=y,H.date=x,H.longtext=F,H.select=I,H.unit=D,H.valueunits=E,H.jpath=A(),a.extend(!0,window,{Slick:{CustomEditors:{TextValue:z,JPath:A(),JPathFactory:A,NumberValue:B,BooleanValue:C,ColorValue:y,Text:z,Date:x,LongText:F,SimpleLongText:G,Select:I,Unit:D},typeEditors:H}}),D.load=async function(){const a=await b.require("mathjs");D.mathjs=a},E.load=async function(){const a=await b.require("mathjs");E.mathjs=a}}(jQuery)});
