define(["modules/default/defaultview","src/util/util","ckeditor","lodash","src/main/grid","chroma"],function(a,b,c,d,e,f){function g(){this._id=b.getNextUniqueId()}return $.extend(!0,g.prototype,a,{init:function(){this.plainHtml=this.module.getConfigurationCheckbox("plainHtml","yes")},inDom:function(){this.initEditor(),this.resolveReady()},blank:{html:function(){this.updateEditor("")}},update:{html:function(a){this.module.data=a;var b=a.get();this.module.definition.richtext=b,this.updateEditor(b)}},initEditor:function(){var a=this,b=this.module.definition.richtext||"";if(this.readOnly=!this.module.getConfigurationCheckbox("editable","isEditable"),this.readOnly&&this.plainHtml)this.dom=$("<div>"),this.dom.html(b),this.module.getDomContent().html(this.dom),this._setCss();else{this.dom=$('<div id="'+this._id+'" contenteditable="true">'),this.dom.html(b),this.module.getDomContent().html(this.dom),this._setCss(),this.module.controller.valueChanged(b),c.instances[this._id]&&c.instances[this._id].destroy(),c.disableAutoInline=!0;var d={extraPlugins:"mathjax,font,sourcedialog,codesnippet",removeButtons:"",language:"en"};this.readOnly&&(d.readOnly=!0,d.removePlugins="toolbar",d.allowedContent=!0),this.instance=c.inline(this._id,d),this.instance.on("change",function(){a.module.controller.valueChanged(a.instance.getData()),a.module.getConfigurationCheckbox("autoHeight","yes")&&(a.module.getDomWrapper().height(a.getContentHeight()+50),e.moduleResize(a.module))})}},updateEditor:function(a){this.plainHtml?this.dom.html(a):this.instance.setData(a)},getContentHeight:function(){var a=0;return this.dom.children().each(function(){a+=$(this).height()}),a},_setCss:function(){var a=this.module.getConfiguration("bgColor");if(this.dom.css({height:"100%",width:"100%",padding:"5px",boxSizing:"border-box"}),this.module.getConfigurationCheckbox("postit","yes")){var c=f(a[0],a[1],a[2]);this.dom.addClass("richtext-postit"),this.dom.parents(".ci-module-wrapper").addClass("ci-module-richtext-postit"),this.dom.css({background:b.getCssVendorPrefix()+"radial-gradient(center, ellipse cover, "+c.brighter().hex()+" 0%, "+c.hex()+" 100%)"})}else this.dom.css({background:""}),this.dom.css({"background-color":"rgba("+a.join(",")+")"}),this.dom.removeClass("richtext-postit"),this.dom.parents(".ci-module-wrapper").removeClass("ci-module-richtext-postit")}}),g});