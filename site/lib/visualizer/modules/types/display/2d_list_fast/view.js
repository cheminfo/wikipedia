'use strict';define(["modules/default/defaultview","src/util/typerenderer","src/util/api","src/util/util"],function(a,b,c,d){"use strict";function e(){}function f(a){for(var b=a.length,c=a[0].length,d=Array(b*c),e=0;e<b;e++)for(var f=0;f<c;f++)d[e*c+f]=a[e][f];return new DataArray(d)}return $.extend(!0,e.prototype,a,{init:function(){this.dom=$("<div class=\"ci-displaylist-list-2d-fast\"></div>"),this.module.getDomContent().html(this.dom),this.rendererOptions=d.evalOptions(this.module.getConfiguration("rendererOptions"))||{};var a=this.module.getConfiguration("forceType");a&&(this.rendererOptions.forceType=a)},blank:{list:function(){this.list=null,c.killHighlight(this.module.getId()),this.dom.empty()},showList:function(){this.showList=null}},inDom:function(){var a=this;this.dom.on("mouseenter mouseleave click","> div",function(b){var d,e=$(this).index(),f=a.list[e];if(1===a.dim)d=[e];else{var g=Math.floor(e/a.dimWidth),h=e%a.dimWidth;d=[g,h]}"mouseenter"===b.type?(a.module.controller.setVarFromEvent("onHover","cell","list",d),c.highlight(f,1)):"mouseleave"===b.type?c.highlight(f,0):"click"===b.type&&(a.module.controller.setVarFromEvent("onClick","cell","list",d),a.module.controller.sendActionFromEvent("onClick","cell",f))}),this.resolveReady()},update:{list:function a(b){var c=b.get();this.setDim(c);var d,a,e,g=this.module.getConfiguration;if(1===this.dim)d=`${100/(g("colnumber",4)||4)}%`,a=c,e=c.length;else{var h=c[0].length;d=`${100/c[0].length}%`,e=c.length*h,a=f(c)}this.dataReady=Array(e),this.dataDivs=Array(e),this.list=a;var j=g("colorjpath",!1),k=g("valjpath",""),l={width:d},m=g("height");m&&(l.height=`${m}px`);for(var n,o=0;o<e;o++)n=this.renderElement(this.list.getChildSync([o]),l,j,k),this.dataReady[o]=n[0],this.dataDivs[o]=n[1];this.updateVisibility()},showList:function(a){var b=a.get();this.setDim(b),this.showList=1===this.dim?b:f(b),this.updateVisibility()}},updateVisibility:function(){if(this.showList&&this.list){var a=this;Promise.all(this.dataReady).then(function(){for(var b=a.showList,c=0;c<b.length;c++)b[c]?a.dataDivs[c].show():a.dataDivs[c].hide()})}},renderElement:function(a,d,e,f){var g=$("<div>").css(d).appendTo(this.dom);return e&&a.getChild(e,!0).then(function(a){g.css("background-color",a.get())}),c.listenHighlight(a,function(a){a?g.css("border-color","black"):g.css("border-color","")},!1,this.module.getId()),[b.render(g,a,f,this.rendererOptions),g]},setDim:function(a){var b=this.dim,c=Array.isArray(a[0])?2:1;c!==b&&(this.dim=c,this.list=null,this.showList=null),2===this.dim&&(this.dimWidth=a[0].length,this.dimHeight=a.length)}}),e});
