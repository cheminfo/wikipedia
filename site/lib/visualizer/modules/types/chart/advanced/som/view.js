define(["modules/default/defaultview","components/jsgraph/dist/jsgraph.min","src/util/color","chroma"],function(a,b,c,d){function e(){}function f(a,b,c,e,f,h,i){var j,k,l=d(c),m=d(e);if("fixed"===a)return k=l.css(),function(){return k};if("range"===a)return j=d.scale([l,m]).mode(b),function(a){return j(a[f]).css()};if("inter"===a){var n=g(c,e),o=(c[3]+e[3])/2;return function(a){return d([n[0](a[f]),n[1](a[h]),n[2](a[i]),o]).css()}}}function g(a,b){return[h(a[0],b[0]),h(a[1],b[1]),h(a[2],b[2])]}function h(a,b){return a=+a,b=+b,function(c){return a*(1-c)+b*c}}return e.prototype=$.extend(!0,{},a,{init:function(){this.dom=document.createElement("div"),this.dom.style.height="100%",this.dom.style.width="100%",this.dom.style.overflow="hidden",this.module.getDomContent().html(this.dom),this.series={},this.datasetInfo={}},inDom:function(){var a=this,c={primaryGrid:!1,secondaryGrid:!1};this.graph=new b(this.dom,{close:{left:!1,right:!1,top:!1,bottom:!1},plugins:{"graph.plugin.zoom":{zoomMode:"xy"},"graph.plugin.drag":{}},pluginAction:{"graph.plugin.zoom":{shift:!1,ctrl:!1},"graph.plugin.drag":{shift:!0,ctrl:!1}},dblclick:{type:"plugin",plugin:"graph.plugin.zoom",options:{mode:"total"}}},{bottom:[c],left:[c]},function(b){b.shapeHandlers.mouseOver.push(function(b){a.module.controller.onCellHover(b.data)}),b.getXAxis().hide().setAxisDataSpacing(0,0),b.getYAxis().hide().setAxisDataSpacing(0,0),a.resolveReady()})},blank:{model:function(){this.graph.removeShapes()},dataset:function(a){this.series[a]&&(this.series[a].kill(),delete this.series[a]),this.datasetInfo[a]&&(this.datasetInfo[a]=null)}},update:{model:function(a){if("SOM"===String(a.get("name"))){var b,c=a.get("data"),d=c.length,e=c[0].length,g=this.graph,h=this.module.getConfiguration.bind(this.module),i=h("bgField1"),j=h("bgField2"),k=h("bgField3"),l=a.options.fields;if(Array.isArray(l))for(b=0;b<l.length;b++)l[b].name===i&&(i=b),l[b].name===j&&(j=b),l[b].name===k&&(k=b);var m=f(h("bgType"),h("bgSpace"),h("bgColor1"),h("bgColor2"),i,j,k);for(g.getXAxis().forceMin(0).forceMax(d),g.getYAxis().forceMin(0).forceMax(e),b=0;d>b;b++)for(var n=0;e>n;n++){var o=g.newShape({type:"rect",pos:{x:b,y:n},pos2:{x:b+1,y:n+1},locked:!0,selectable:!1,fillColor:m(c[b][n]),layer:1,info:c[b][n]},null,null,!0);o.draw(),o.redraw()}this.redraw()}},dataset:function(a,b){var c,e,g,h=this.module.getConfiguration("datasets");if(h)for(c=0;c<h.length;c++)if(h[c].groups.group[0].dataset[0]===b){g=h[c].groups.group[0];break}if(g)switch(g.colorType[0]){case"fixed":e=f("fixed",null,g.color1[0]);break;case"jpath":e=function(a){return d(String(DataObject.check(a).getChildSync(g.jpath1[0]))).css()}}else e=f("fixed",null,[255,0,0,1]);var i,j=this,k=a.getChildSync(["data","0"]),l=k.x.length,m=new Array(2*l),n=new Array(l);for(c=0;l>c;c++)m[2*c]=k.x[c],m[2*c+1]=k.y[c],i=e(k.info[c]),n[c]={fill:i};var o=this.series[b]=this.graph.newSerie(b,{layer:2},"scatter").autoAxis().setData(m).setStyle({shape:"circle",r:3,stroke:"black"},n).setStyle({r:6},"selected");k.info&&(o.on("mouseover",function(a){o.selectPoint(a),j.module.controller.onElementHover(k.x[a],k.y[a],k.info[a])}),o.on("mouseout",function(a){o.selectPoint(a,!1)})),this.redraw()}},onResize:function(a,b){this.graph&&(this.graph.resize(a,b),this.redraw())},redraw:function(){this.graph.redraw(),this.graph.autoscaleAxes(),this.graph.drawSeries()}}),e});