define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util","lib/jit/jit-custom"],function(a,b,c,d){function e(){}return e.prototype=$.extend(!0,{},a,{DEBUG:!1,highlightNode:function(){node.setCanvasStyle("shadowBlur",0,"start"),node.setCanvasStyle("shadowBlur",10,"end"),this._rgraph.fx.animate({modes:["node-style:shadowBlur"],duration:200})},init:function(){this.DEBUG&&console.log("Dendrogram: init"),this.dom||(this._id=d.getNextUniqueId(),this.dom=$('<div id="'+this._id+'"></div>').css("height","100%").css("width","100%"),this.module.getDomContent().html(this.dom)),this.dom&&this.dom.empty(),this._rgraph&&delete this._rgraph,this._highlighted={},this.updateOptions(),this.resolveReady(),this.DEBUG&&console.log("Dendrogram: ID: "+this._id)},inDom:function(){this.DEBUG&&console.log("Dendrogram: inDom")},onResize:function(){this.DEBUG&&console.log("Dendrogram: onResize"),this.createDendrogram(),this.updateDendrogram()},getIdHash:function(a){if(a.id&&(this._idHash[a.id]=a),Array.isArray(a.children))for(var b=0;b<a.children.length;b++)this.getIdHash(a.children[b])},update:{tree:function(a){if(this.DEBUG&&console.log("Dendrogram: update"),a&&a.value){if(this._value=$.extend(!0,new DataObject({}),a.get()),this._idHash={},this.getIdHash(a.get()),!this._rgraph){if(!document.getElementById(this._id))return;this.createDendrogram()}this.updateDendrogram()}}},updateDendrogram:function(){this.DEBUG&&console.log("Dendrogram: updateDendrogram"),this._rgraph&&this._value&&(this._rgraph.loadJSON(this._value),$jit.Graph.Util.each(this._rgraph.graph,function(a){a.name=a.data&&a.data.label?a.data.label:""}),this._rgraph.refresh())},updateOptions:function(){var a=$.proxy(this.module.getConfiguration,this.module);this._options={nodeSize:a("nodeSize")||1,nodeColor:a("nodeColor")||"yellow"}},createDendrogram:function(){var a=this;this.DEBUG&&console.log("Dendrogram: createDendrogram");var b=this.module.vars_out();if(b&&0!=b.length){var c=function(b){a.module.controller.onHover(a._idHash[b.id])},d=$.proxy(this.module.getConfiguration,this.module);this.dom.empty();{this._options}this._rgraph=new $jit.RGraph({injectInto:this._id,levelDistance:50,background:{CanvasStyles:{strokeStyle:d("strokeColor")||"#333",lineWidth:d("strokeWidth")||"1"}},Navigation:{enable:!0,panning:!0,zooming:50},Edge:{overridable:!0,color:d("edgeColor")||"green",lineWidth:d("edgeWidth")||.5},Label:{overridable:!0,type:"Native",size:d("labelSize")||10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:d("labelColor")||"black"},Node:{CanvasStyles:{shadowColor:"rgb(0, 0, 0)",shadowBlur:0},overridable:!0,type:d("nodeType")||"circle",color:d("nodeColor")||"yellow",dim:d("nodeSize")||3,height:3,width:3,lineWidth:10},Events:{getRgraph:function(a){var b=a.srcElement.id.replace(/-.*/,"");return $jit.existingInstance[b]?$jit.existingInstance[b]:(b=a.srcElement.parentElement.id.replace(/-.*/,""),$jit.existingInstance[b]?$jit.existingInstance[b]:void 0)},enable:!0,enableForEdges:!0,type:"Native",onClick:function(a,b,c){if(a){var d,e=this.getRgraph(c);if(a.collapsed)d=a;else if(a.ignore)for(d=a.getParents()[0];d.ignore;)d=d.getParents()[0];else a.nodeFrom&&(d=a.nodeFrom._depth>a.nodeTo._depth?a.nodeFrom:a.nodeTo,a.nodeFrom.collapsed&&(d=a.nodeFrom),a.nodeTo.collapsed&&(d=a.nodeTo));d?d.collapsed?e.op.expand(d,{type:"animate",duration:1e3,hideLabels:!1,transition:$jit.Trans.Quart.easeInOut}):e.op.contract(a.nodeFrom,{type:"animate",duration:1e3,hideLabels:!0,transition:$jit.Trans.Quart.easeInOut}):a.ignore||e.onClick(a.id)}},onMouseEnter:function(a,b,d){c(a),this.getRgraph(d).canvas.getElement().style.cursor="pointer"},onMouseLeave:function(a,b,c){this.getRgraph(c).canvas.getElement().style.cursor=""}},Tips:{enable:!1}}),$jit.existingInstance=$jit.existingInstance||{},$jit.existingInstance[this._id]=this._rgraph}},getDom:function(){return this.DEBUG&&console.log("Dendrogram: getDom"),this.dom},_doHighlight:function(a,b){if(this.DEBUG&&console.log("Dendrogram: _doHighlight"),!(this._highlighted[a]&&b||!this._highlighted[a]&&!b)){this._highlighted[a]=b;for(var d in this._currentValue._atoms)this._currentValue._atoms[d].indexOf(a)>-1&&c.highlight(d,b)}}}),e});